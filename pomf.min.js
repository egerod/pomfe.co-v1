document.addEventListener("DOMContentLoaded", function () {
	function a(a) {
		var b = document.createElement("li"),
			c = document.createElement("span");
		c.textContent = a.name, c.className = "file-name";
		var d = document.createElement("span");
		d.className = "progress-percent", d.textContent = "0%";
		var e = document.createElement("progress");
		return e.className = "file-progress", e.setAttribute("max", "100"), e.setAttribute("value", "0"), b.appendChild(c), b.appendChild(e), b.appendChild(d), document.getElementById("upload-filelist").appendChild(b), b
	}

	function updateProgressBar(a) {
		var target = a.target,
			bar = target.bar,
			percentElement = target.percent;
		if (a.lengthComputable) {
			var percent = Math.floor(a.loaded / a.total * 100);
			bar.setAttribute("value", percent), percentElement.textContent = percent + "%"
		}
	}

	function showUploadResult(a) {
		var target = a.target,
			bar = target.bar,
			row = target.row,
			percent = target.percent;
		percent.style.visibility = "hidden"
		bar.style.visibility = "hidden"
		row.removeChild(bar)
		row.removeChild(percent)
		var status = target.status, 
			span = document.createElement("span");
		span.className = "file-url"
		row.appendChild(span);
		var aElement = document.createElement("a");
		if (200 === status) {
			var responseBody = JSON.parse(target.responseText);
			responseBody.status === "Success" ? (aElement.textContent = responseBody.message.link.replace(/.*?:\/\//g, ""), aElement.href = responseBody.message.link, span.appendChild(aElement)) : bar.innerHTML = "Error: " + responseBody.message.body
		} else 413 === status ? (aElement.textContent = "File Too big!", span.appendChild(aElement)) : (aElement.textContent = "Server error!", span.appendChild(aElement))
	}

	function startProgressBar(files, row) {
		var fileProgress = row.querySelector(".file-progress"),
			progress = row.querySelector(".progress-percent"),
			httpRequest = new XMLHttpRequest();
		httpRequest.open("POST", "/upload.php")
		httpRequest.row = row
		httpRequest.bar = fileProgress
		httpRequest.percent = progress
		httpRequest.upload.bar = fileProgress
		httpRequest.upload.percent = progress
		httpRequest.addEventListener("load", showUploadResult, !1)
		httpRequest.upload.onprogress = updateProgressBar;
		var formData = new FormData();
		formData.append("files[]", files) 
		httpRequest.send(formData)
	}

	function e(a) {
		a.stopPropagation(), a.preventDefault()
	}

	function f(a, b, c) {
		e(c), 1 == a.dragCount && (b.textContent = "Drop it here~"), a.dragCount += 1
	}

	function g(a, b, c) {
		e(c), a.dragCount -= 1, 0 == a.dragCount && (b.textContent = "Select or drop file(s)")
	}

	function h(b, c, f) {
		e(f), g(b, c, f);
		for (var h = f.dataTransfer.files.length, i = 0; i < h; i++) {
			var j = f.dataTransfer.files[i],
				k = a(j);
			startProgressBar(j, k)
		}
	}

	function i(b) {
		for (var c = b.target.files.length, e = 0; e < c; e++) {
			var f = b.target.files[e],
				g = a(f);
			startProgressBar(f, g)
		}
	}

	function j(a, b) {
		e(b), a.click()
	}
	window.addEventListener("paste", function (b) {
		var c = (b.clipboardData || b.originalEvent.clipboardData).items;
		for (index in c) {
			var e = c[index];
			if ("file" === e.kind) {
				var f = e.getAsFile(),
					g = new File([f], "pasted-image." + f.type.match(/(?:[^\/]*\/)([^;]*)/)[1]);
				g.type = f.type;
				var h = a(g);
				startProgressBar(g, h)
			}
		}
	});
	var k = {
		dragCount: 0
	},
		l = document.getElementById("upload-btn");
	window.addEventListener("dragenter", f.bind(this, k, l), !1), window.addEventListener("dragleave", g.bind(this, k, l), !1), window.addEventListener("drop", g.bind(this, k, l), !1), window.addEventListener("dragover", e, !1);
	var m = document.getElementById("upload-input");
	m.addEventListener("change", i), l.addEventListener("click", j.bind(this, m)), l.addEventListener("drop", h.bind(this, k, l), !1), document.getElementById("upload-form").classList.add("js")
});

window.onload = function () {
	var anonF = document.getElementById('anonFalse');
	anonF.onclick = function () {
		SetAnonState(false);
	}
	var anonT = document.getElementById('anonTrue');
	anonT.onclick = function () {
		SetAnonState(true);
	}
}

function SetAnonState(state) {
	if (state == false) {
		document.cookie = "IsAnon=False";
	} else {
		document.cookie = "IsAnon=True";
	}
}

document.addEventListener('DOMContentLoaded', function () {
	document.querySelector('#anonTrue').addEventListener('click', SetAnonState(true));
});